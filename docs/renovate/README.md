# Renovate at ClickUp

By default our TypeScript repos have Renovate enabled to manage dependencies.
This document describes the default configuration and some common use patterns.

## Default Configuration

The configuration is defined in `renovate.json5` and defaults to the following.

```json
// ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".
{
  "labels": [
    "renovate"
  ],
  "schedule": [
    "before 1am on Monday"
  ],
  "extends": [
    "config:base",
    "group:recommended",
    "group:monorepos",
    "github>whitesource/merge-confidence:beta"
  ],
  "packageRules": [
    {
      "groupName": "all non-major dependencies",
      "groupSlug": "all-minor-patch",
      "matchPackagePatterns": [
        "*"
      ],
      "matchUpdateTypes": [
        "minor",
        "patch"
      ],
      "addLabels": []
    },
    {
      "matchDepTypes": [
        "optionalDependencies"
      ],
      "addLabels": [
        "optional"
      ]
    }
  ],
  "ignoreDeps": [
    "@time-loop/cdk-log-parser",
    "@types/jest",
    "@types/node",
    "@typescript-eslint/eslint-plugin",
    "@typescript-eslint/parser",
    "aws-cdk",
    "eslint",
    "jest-junit",
    "jest",
    "npm-check-updates",
    "standard-version",
    "ts-jest",
    "ts-node",
    "aws-cdk-lib",
    "constructs",
    "node"
  ],
  "rangeStrategy": "bump",
  "prHourlyLimit": 0,
  "prConcurrentLimit": 0,
  "automergeType": "pr",
  "platformAutomerge": true
}
```

You can tune literally all of these options,
but the defaults are a good starting point.
See [the projen docs](http://projen.io/api/API.html#projen-renovatebotoptions)
for a starting point on how to customize.

## Enabling AutoMerge for Updates

To enable this, in your `.projenrc.ts` add the following:

```ts
  autoApproveUpgrades: true,
  autoApproveOptions: {
    allowedUsernames: [renovateWorkflow.RENOVATE_GITHUB_USERNAME],
    label: renovateWorkflow.AUTO_APPROVE_PR_LABEL,
  },
```

## Pinning Problem Libraries

You may only pin libraries if you have created a task
to address the issue in the future.

- Your PR to pin MUST reference the task.
- Your pinning code MUST include a link to the task.
- Your squad SHOULD have a plan to address the
  associated tech debt in the next quarter.

Example
[task](https://staging.clickup.com/t/333/CLK-211432),
[pr](https://github.com/time-loop/click/pull/89),
[comment](https://github.com/time-loop/click/pull/89/files#diff-bda22a3de7550efc76dd29e2a427a8d5abd5863f6e96a339ff47390d9bed7d14R42)

Example code from `.projenrc.ts` in the PR.

```ts
  renovatebotOptions: {
    // See https://staging.clickup.com/t/333/CLK-211432
    // tl;dr: we get the following error when we touch the oclif libs.
    //
    // ðŸ‘¾ build Â» compile | tsc --build
    // Error: node_modules/@oclif/parser/lib/index.d.ts(16,35): error TS2344: Type 'TFlags' does not satisfy the constraint 'Output'.
    // Error: node_modules/@oclif/parser/lib/index.d.ts(16,52): error TS2344: Type 'TFlags' does not satisfy the constraint 'OutputFlags<any>'.
    // Error: node_modules/@oclif/command/lib/command.d.ts(70,31): error TS2344: Type 'F' does not satisfy the constraint 'Output'.
    // Error: node_modules/@oclif/command/lib/command.d.ts(70,67): error TS2344: Type 'F' does not satisfy the constraint 'OutputFlags<any>'.
    // ðŸ‘¾ Task "build Â» compile" failed when executing "tsc --build" (cwd: /home/runner/work/click/click)
    // Error: Process completed with exit code 1.
    ignore: [
      '@oclif/core',
      '@oclif/command',
      '@oclif/config',
      '@oclif/plugin-help',
      '@oclif/plugin-not-found',
      '@oclif/test',
      'oclif',
    ],
  },

```
